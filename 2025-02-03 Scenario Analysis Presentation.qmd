---
title: "Scenario analysis"
subtitle: "An update on project to date"
author: "Gabriel Hobro and Fikriyudin Mufasir"
date: 2025-02-03
date-format: "D MMMM YYYY"
format: 
  revealjs:
    theme: [default, su_presentation.scss]
    embed-resources: true
transition: none
chalkboard:
  buttons: false
preview-links: auto
slide-number: false
auto-animate: true
footer: |
  "See the (private) repo [here](https://github.com/The-Strategy-Unit/nhp_scenario_analysis)"
---

```{r run_scripts}
source("scenario_v1.R")
source("scenario_impact_changes.R")
source("step_change_cliniplan.R")
```

## Overview

A high-level summary

-   Our MVP will be to focus on the outputs under the principal projection for the two scenarios

-   In later iterations, we can include a comparison of the output distributions under each scenario and visual comparisons of the inputs provided by the scheme

-   The following slides contain a breakdown of the initial suggestions, based on the existing outputs app...


## Summary table

::: columns
::: {.column width="40%"}
We have created a group bar chart with one bar for each scenario using principal projection value split by activity type/measure (inpatient admission,inpatient bed days, outpatient, ED) and point of delivery (each a subset of activity type/ measure)

We have generate a function to reproduce other activity type/measure
:::

::: {.column width="60%"}
```{r high-level-bar-chart}
create_bar_plot(data, "Inpatient", "Admissions", "Imperial NDG Inpatient Scenarios")

```

:::
:::

<!-- ## Length of stay breakdown -->

<!-- If we have something -->

## Waterfalls

::: columns
::: {.column width="40%"}
We have generated waterfall chart from two scenarios and presented them into a single plot using the same color coding in the original version. Also, includes filters for activity type (IP,OP,ED) and measure (admissions/bed days/attendances)
:::

::: {.column width="60%"}
```{r waterfall_example}
generate_waterfall_plot(pcfs_ndg1, pcfs_ndg2, 
                        activity_type_ndg1 = "ip", 
                        activity_type_ndg2 = "ip",
                        measure = "admissions", 
                        title = "Inpatient admissions waterfall scenario comparison", 
                        x_label = "Admissions", 
                        y_label = "Change factor")

```

:::
:::

## Mitigator impact chart

::: columns
::: {.column width="40%"}

-   We have created a group bar chart with filters for activity type (IP,OP,ED), point of delivery (subset of activity type), and measure (admissions) inside one function to generate other scenario comparison in efficiency and activity avoidance.

:::

::: {.column width="60%"}
```{r impact_slides}


library(cowplot)

# make a plot grid consisting of two panels
p1 <- impact_bar_plot(ndg_variants_sc_comparison,"activity_avoidance", "ip", "beddays", "Avoidance")

p2 <- impact_bar_plot(ndg_variants_sc_comparison,"efficiencies", "ip", "beddays", "Efficiencies")

plot_col <- plot_grid(p1, p2, nrow=2)

# now add the title
title <- ggdraw() + 
  draw_label(
    "Example mitigator impact charts",
    fontface = 'bold',
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )

plot_grid(
  title, plot_col,
  ncol = 1,
  # rel_heights values control vertical title margins
  rel_heights = c(0.1, 1)
)
```

:::
:::

<!-- ## Activity in detail -->

<!-- If we have something -->

## Cliniplan

::: columns
::: {.column width="40%"}

-   The project aimed to automate Cliniplan Workbook which takes the step counts from the excel download and then calculate various conversions.

-   We have automated Cliniplan workbook into R and visualised top 12 mitigators at the impact of beds under an 85% occupancy.

-   The next step for this project will probably building an app to allow user to set filter on occupancy and spesific strategies.

:::

::: {.column width="60%"}

```{r clin-plan}
ggplot(calc_85_rate,
       aes(x=reorder(strategy,at_85), y=at_85, fill = Type)) + 
  geom_bar(stat = "identity") +
  coord_flip()  +
  ggtitle("Adjusted Beds at 85% Occupancy") +
  ylab("Beds") +
  xlab("Mitigator") +
    scale_fill_manual(values = c("#f9bf07","#686f73"), name="Type",
                      labels = c("Top 12", "Others")) +
  easy_center_title() + theme(text = element_text(family = "Segoe UI")) +
  theme(axis.text.x = element_text(family = "Segoe UI", size = 12, color="black")) +
  theme(axis.text.y = element_text(family = "Segoe UI", size = 12, color="black")) +
  theme(axis.title.x = element_text(family = "Segoe UI", size = 12, color="black")) +
  theme(axis.title.y = element_text(family = "Segoe UI", size = 12, color="black")) +
  theme(legend.title = element_text(family = "Segoe UI", size = 12, color="black")) +
  theme(legend.text = element_text(family = "Segoe UI", size = 12, color="black"))
```


:::
:::

## Later steps

Comparison of distributions and inputs?

Do the previous analyses constitute an MVP?
